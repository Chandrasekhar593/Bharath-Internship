<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Voice, Our Rights - MGNREGA Dashboard</title>

<!-- Bootstrap for responsive layout -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Animate.css for animations -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<!-- GSAP for fancy animations -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #f5f7fa, #d9a7c7);
    min-height: 100vh;
}
h1,h2,h3 { text-shadow: 2px 2px 6px rgba(0,0,0,0.2); }
.card {
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    margin: 15px;
    transition: transform 0.5s ease, background 0.5s ease;
}
.card:hover {
    transform: translateY(-10px) scale(1.05);
    background: linear-gradient(135deg, #fbc2eb, #a6c1ee);
}
#districtSelect {
    background: linear-gradient(to right, #ff758c, #ff7eb3);
    color: white;
    font-weight: bold;
    border-radius: 12px;
    padding: 10px;
    margin-top: 15px;
}
.kpi-label { font-weight: bold; font-size: 16px; color: #fff; text-shadow:1px 1px 3px rgba(0,0,0,0.4);}
.kpi-value { font-size: 28px; color: #fff; font-weight: 700;}
.pie-container, .trend-container { max-width: 450px; margin: 30px auto; }
.description-box {
    background: rgba(255,255,255,0.85);
    border-radius: 15px;
    padding: 15px;
    margin: 15px 0;
    text-align: justify;
    font-size: 14px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<div class="container text-center mt-5">
    <h1 class="animate__animated animate__fadeInDown">MGNREGA District Dashboard</h1>
    <p class="animate__animated animate__fadeInUp">Visualize the performance of your district in a simple and colorful way!</p>

    <select id="districtSelect" class="animate__animated animate__fadeInUp">
        <option value="">Detecting your district...</option>
    </select>

    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card p-3 animate__animated animate__fadeInLeft" id="beneficiariesCard">
                <p class="kpi-label">Beneficiaries</p>
                <p class="kpi-value" id="beneficiaries">--</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 animate__animated animate__fadeInUp" id="workdaysCard">
                <p class="kpi-label">Person-Days</p>
                <p class="kpi-value" id="personDays">--</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 animate__animated animate__fadeInRight" id="wagesCard">
                <p class="kpi-label">Wages (₹)</p>
                <p class="kpi-value" id="wages">--</p>
            </div>
        </div>
    </div>

    <div class="pie-container animate__animated animate__zoomIn">
        <canvas id="pieChart"></canvas>
    </div>

    <div class="description-box animate__animated animate__fadeInUp" id="descriptionBox">
        Select a district to see a description of the latest MGNREGA data.
    </div>
</div>

<script>
// --- All Indian districts (sample: abbreviated, replace with full list or fetch from API) ---
const districts = [
  "Adilabad","Agra","Ahmedabad","Ahmednagar","Aizawl","Ajmer","Alappuzha","Alirajpur",
  "Allahabad","Almora","Alwar","Ambala","Amethi","Amravati","Amritsar","Anantapur"
  // ... continue with all Indian districts
];

const districtSelect = document.getElementById("districtSelect");

// Populate districts in dropdown
function populateDistricts() {
    districtSelect.innerHTML = '<option value="">Select your district</option>';
    districts.forEach(d => {
        const option = document.createElement("option");
        option.value = d;
        option.text = d;
        districtSelect.appendChild(option);
    });
}

// --- Auto-detect location using browser geolocation ---
function detectLocation() {
    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            console.log(position.coords);
            // In real implementation, map lat/lng to nearest district
            // For demo, pick random district
            const index = Math.floor(Math.random()*districts.length);
            districtSelect.value = districts[index];
            fetchDistrictData(districts[index]);
        }, () => populateDistricts());
    } else {
        populateDistricts();
    }
}

// --- Fetch and display district data ---
let pieChart;
districtSelect.addEventListener("change", () => {
    const district = districtSelect.value;
    if(district) fetchDistrictData(district);
});

async function fetchDistrictData(district) {
    try {
        // Replace with actual API URL
        const apiUrl = `https://data.gov.in/api/mgnrega/monthly_performance?state=ALL`;
        const res = await fetch(apiUrl);
        const data = await res.json();

        // Demo: Random numbers for visualization
        const record = {
            beneficiaries: Math.floor(Math.random()*1000000),
            person_days: Math.floor(Math.random()*5000000),
            wages: Math.floor(Math.random()*100000000)
        };

        document.getElementById("beneficiaries").innerText = record.beneficiaries.toLocaleString();
        document.getElementById("personDays").innerText = record.person_days.toLocaleString();
        document.getElementById("wages").innerText = record.wages.toLocaleString('en-IN', {style:'currency', currency:'INR'});

        const total = record.beneficiaries + record.person_days + record.wages;
        const percentages = [
            ((record.beneficiaries/total)*100).toFixed(1),
            ((record.person_days/total)*100).toFixed(1),
            ((record.wages/total)*100).toFixed(1)
        ];

        const ctx = document.getElementById('pieChart').getContext('2d');
        if(pieChart) pieChart.destroy();
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Beneficiaries', 'Person-Days', 'Wages'],
                datasets: [{
                    data: percentages,
                    backgroundColor: ['#ff6b6b','#feca57','#48dbfb'],
                    borderWidth: 1
                }]
            },
            options: { responsive:true, plugins:{ legend:{ position:'bottom', labels:{ color:'#333', font:{size:14} } } } }
        });

        // Update description box
        document.getElementById("descriptionBox").innerText =
            `District ${district} recorded ${record.beneficiaries.toLocaleString()} beneficiaries, `+
            `${record.person_days.toLocaleString()} person-days of work, `+
            `and ₹${record.wages.toLocaleString('en-IN')} in wages. `+
            `This shows the contribution and impact of MGNREGA in the region clearly.`;

        // Animate cards using GSAP
        gsap.from(".card", {duration: 1, y:50, opacity:0, stagger:0.2, ease:"back.out(1.7)"});
        gsap.from(".description-box", {duration:1, opacity:0, y:30});
        gsap.from(".pie-container", {duration:1, scale:0.5, opacity:0, ease:"elastic.out(1,0.5)"});

    } catch(err) {
        console.error(err);
        alert("Failed to fetch data. Try again later.");
    }
}

// --- Initialize ---
detectLocation();
</script>

</body>
</html>
